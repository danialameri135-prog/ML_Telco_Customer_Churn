# ML_Telco_Customer_Churn
✅ تمیز کردن داده

✅جلوگیری از Leakage

✅ ه OHE کردن ستون های غیر عددی

✅ کشف همبستگی ها با ستون تارگت

✅انتخاب Scale درست

✅ه ساخت pipeline

✅ استفاده از مدل های هیبریدی

✅ مقایسه مدل ها با نمودار ها و کشف بهترین مدل

✅استفاده از optuna برای تنظیم هایپر پارامتر ها

✅ تفسیر مدل با shap

✅ انتقال تجربه

## مساله
پروژه تشخیص رفتن مشتری از شرکت

## پروژه و تجربه هام
در ظاهر هیچ مقادیر خالی نداریم ولی با بررسی بیشتر فهمیدم که 11 مقدار خالی دارم که حذفشون کردم

تایپ ستون ها را چک کردم فهمیدم که یک ستونی که تایپش در اصل باید float باشد object هست
پس اونو درست کردم 

بالانس بودن داده را چک کردم که خوبه نامتوازن نبود 

اول دیتتاست را تقسیم کردم سپس OHE و Scale انجام دادم چرا؟ برا جلوگیری از لیکیج 

فهمیدم که همبستگی ستون ها پایینه و یک فرضیه مطرح کردم اینکه احتمالا نمره بالایی نخواهیم گرفت چون مدل قادر به شناسایی الگو ها نیست

نامتقارن بودن داده را چک کردم و چون مقادیر کتگوریکال بودند نمیتونستم توضیع را اصلاح کنم پس از RobustScaler توی pipeline استفاده کردم که در برابر نامتقارن ها مقاومه

مدل ها را درست کردم و هایپرپارامتر هاشونو تنظیم کردم و از مدل های هیبریدی هم استفاده کردم 

یک تابع ساختم که بهم گزارش کامل تمام مدل هایی که ساختم را بده

## انتخاب متریک درست 
خب ما میدونیم که مهمترین متریک recall هست هرچقدر بالاتر باشه بهتره البته تا یه حدی پس اولویت اولمون recall هست 
اگر recall خیلی بالا باشه و precision خیلی پایین یعنی مشکلی وجود داره یعنی مدل میگه که من همه اونایی که میرند را تشخیص دادم ولی مشتری هایی که از شرکت نمیرند را هم باهاشون قاطی کردم یعنی ما علکی زنگ میزنیم و تخفیف میدیم و هزینه میکنیم به اونهایی که از شرکت نرفتند و مدندگار بودند 

اگر هردو بالا باشند عالیه 

اولویت سوم
و F1 تشخیص میده که چقدر این دوتا متعادل هستند اگر F1 پایین باشه یعنی مدل در مجموع خوب عمل نکرده و اگر بالا باشه یعنی مدل متعادله و خوب عمل کرده

## انتخاب مدل درست
من برای تشخیص بهترین مدل نمودار رسم کردم فهمیدم که مدل XGBoost بهترینه چرا؟ چون اختلاف نمره train و test اون خیلی کمه یعنی مدل پایدارتره و همچنین نمره test نسبتا خوبی داشته من چون پایداره انتخابش کردم چرا LGBM را انتخاب نکردم؟ چون در آستانه Overfit بودنه 
و یک نکته همه مدل هایی که آموزش دیدند Underfit هستند ولی از بین اینها xgb بهترین بود

پس با optuna پارامتر هاشو تنظیم کردم

## تفسیر مدل

و سپس میرسیم به تفسیر مدل
نمودار summary
مدل میگه اگر زمان همکاری اون فرد ماهانه باشه احتمال رفتنش بالاست ولی اگر سالانه باشه احتمال رفتنش پایینه که با منطق ما هم جور هست

و همچنین میگه هرچی اشتراک فرد در این شرکت بالاتر باشه احتمال ماندنش بالاتره

و هرچی شارژ ماهانه فرد در شرکت بیشتر باشه احتمال رفتنش بیشتره

ولی میگه هرچی شارژ کل بیشتر باشه احتمال ماندنش بیشتره 
که انگار مدل به یک تناقضی رسیده یعنی میگه اگر هرچی شارژ ماهانه فرد در شرکت بیشتر باشه احتمال رفتنش بیشتره ولی هرچی شارژ کل بیشتر باشه احتمال رفتنش کمتره که احتمالا یکی از دلایل Underfit بودن مدل همین تناقض هست

و یک چیز جالبی هم دیدم 
مدل میگه اگر فرد اینترنت نداشته باشه احتمال رفتنش کمتره

و اگر پارتنر نداشته باشه هم احتمال رفتنش پایین تره

و بقیه ستون ها هم تفسیر خودشون را دارند چون متن طولانی میشه فقط مهم ها را تفسیر کردم 


خب میرسیم به نمودار waterfall


 این نمودار یک نمونه را بررسی میکنه من نمونه 0 و 500 را بررسی کردم اون اولش یک نقطه ثابت درنظر میگیره و بعد میگه مثلا اگر سابقه فرد باشرکت ماهانه باشه من 5 درصد به احتمال رفتنش اضافه میکنم و اگر اشتراک فرد پایین باشه من 2 درصد از احتمال ماندنش کم میکنم اگر تلویزیون نداره من 3 درصد به احتمال ماندش میدم و... و بعدش همه اینها را جمع میکنه و سپس میگه که این فرد میره یا میمونه

و نمودار آخر برای تایید حرف های قبلی است

## حرف آخر:
درسته که مدل ما Underfit هست ولی پایدار تر از مدل های دیگه بود و همچنی تفسیر های خیلی خوبی ازش در اووردیم و فهمیدیم که مشکل از داده است یعنی یا باید داده را افزایش بدیم یا فیچر های جدید بیاریم

## کتابخانه ها
pandas,numpy,matplotlib,seaborn,sklearn optuna,shap,statsmodels

## فایل های پروژه
فایل اصلی پروژه
project_a3.ipynb
فایل دیتاست 
WA_Fn-UseC_-Telco-Customer-Churn.csv
